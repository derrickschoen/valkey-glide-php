name: "Create Version PR"
description: "Create pull request for version bump"
inputs:
  version:
    description: "Version being updated"
    required: true
  temp-branch:
    description: "Source branch for PR"
    required: true
  target-branch:
    description: "Target branch for PR"
    required: true
  dry-run:
    description: "Dry run mode - show what PR would be created"
    required: false
    default: "false"
  github-token:
    description: "GitHub token for API access"
    required: true

outputs:
  pr-number:
    description: "Pull request number (999 for dry run)"
    value: ${{ steps.create-pr.outputs.pr-number }}

runs:
  using: "composite"
  steps:
    - name: Create Pull Request
      id: create-pr
      uses: actions/github-script@v7
      with:
        github-token: ${{ inputs.github-token }}
        script: |
          const version = '${{ inputs.version }}';
          const tempBranch = '${{ inputs.temp-branch }}';
          const targetBranch = '${{ inputs.target-branch }}';
          const dryRun = '${{ inputs.dry-run }}' === 'true';

          const prTitle = `Version bump to v${version}`;
          const prBody = `## Version Bump to v${version}

          This PR updates the version constants for the ${version} release.

          ### Changes Made:
          - Updated \`common.h\` with version \`${version}\`
          - Updated \`package.xml\` with version \`${version}\`
          - Updated date and time in \`package.xml\`
          - Version consistency validated

          ### Target Branch: \`${targetBranch}\`

          ### Next Steps:
          1. **Review and approve** this version bump
          2. **Merge** this PR to \`${targetBranch}\`
          3. **Approve tag creation** when prompted
          4. **Tag and release** will be created from \`${targetBranch}\`

          **Ready for review and merge!** ðŸš€`;

          if (dryRun) {
            console.log('DRY RUN: Would create PR with the following details:');
            console.log(`Title: ${prTitle}`);
            console.log(`Head: ${tempBranch}`);
            console.log(`Base: ${targetBranch}`);
            console.log('Body:');
            console.log(prBody);
            
            // Return a fake PR number for dry run
            core.setOutput('pr-number', 999);
            return 999;
          }

          const { data: pr } = await github.rest.pulls.create({
            owner: context.repo.owner,
            repo: context.repo.repo,
            title: prTitle,
            head: tempBranch,
            base: targetBranch,
            body: prBody,
            draft: false
          });

          console.log(`Created PR #${pr.number}: ${pr.html_url}`);
          core.setOutput('pr-number', pr.number);
          return pr.number;
